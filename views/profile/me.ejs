<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profil Saya - Pop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  
  <style>
    /* Styling Pop Theme */
    :root { --pop-color: #f44336; --pop-hover: #d32f2f; }
    body { background-color: #f8f9fa; }
    .text-pop { color: var(--pop-color) !important; }
    .btn-pop { background-color: var(--pop-color); border-color: var(--pop-color); color: white; border-radius: 50px; font-weight: 600; }
    .btn-pop:hover { background-color: var(--pop-hover); border-color: var(--pop-hover); color: white; }
    .nav-link-home { color: #555; text-decoration: none; font-weight: 600; }
    .nav-link-home:hover { color: var(--pop-color); }
    .card-profile { border: none; border-radius: 1rem; border-top: 5px solid var(--pop-color); }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold fs-3 text-pop" href="/">Pop.</a>
      <div class="collapse navbar-collapse justify-content-end">
        <a href="/" class="nav-link-home d-flex align-items-center gap-1">
            <i class="bi bi-house-door-fill"></i> Beranda
        </a>
      </div>
    </div>
  </nav>

  <section class="py-5">
    <div class="container">
      <div class="row justify-content-center">
        
        <div class="col-lg-4 mb-4">
            <div class="card card-profile bg-white shadow-sm h-100">
                <div class="card-body text-center p-5">
                    
                    <div class="rounded-circle bg-light d-flex align-items-center justify-content-center text-pop fw-bold border mx-auto mb-3" style="width: 100px; height: 100px; font-size: 2.5rem;">
                        <%= user.Profile ? user.Profile.username[0].toUpperCase() : user.email[0].toUpperCase() %>
                    </div>

                    <h3 class="fw-bold mb-1"><%= user.Profile ? user.Profile.username : 'No Username' %></h3>
                    <p class="text-muted mb-3"><%= user.email %></p>

                    <% if (user.Profile && user.Profile.bio) { %>
                        <p class="mb-4 fst-italic">"<%= user.Profile.bio %>"</p>
                    <% } else { %>
                        <p class="text-muted small mb-4">(Belum ada bio)</p>
                    <% } %>

                    <div class="d-grid gap-2">
                        <a href="/profile/edit" class="btn btn-outline-secondary rounded-pill">
                            <i class="bi bi-pencil-square"></i> Edit Profil
                        </a>
                    </div>

                    <hr class="my-4">
                    
                    <div class="text-start">
                        <small class="text-muted d-block mb-1">Bergabung Sejak</small>
                        <p class="fw-bold"><%= user.createdAt.toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
                        
                        <small class="text-muted d-block mb-1">Role</small>
                        <span class="badge bg-success-subtle text-success px-3 rounded-pill"><%= user.role %></span>
                    </div>

                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <h4 class="fw-bold mb-4 text-secondary">Postingan Saya (<%= user.Posts.length %>)</h4>
            
            <% if(user.Posts.length === 0) { %>
                <div class="alert alert-light border shadow-sm text-center py-4 rounded-4">
                    Belum ada postingan. <a href="/pop/add" class="text-pop fw-bold text-decoration-none">Mulai nulis yuk!</a>
                </div>
            <% } else { %>
                <% user.Posts.forEach(post => { %>
                    <div class="card border-0 shadow-sm mb-3 rounded-4">
                        <div class="card-body">
                            
                            <div class="d-flex justify-content-between align-items-center">
                                
                                <small class="text-muted">
                                    <%= post.formattedDate %> 
                                </small>

                                <div class="d-flex gap-2">
                                    <a href="/pop/<%= post.id %>/edit" class="btn btn-sm text-secondary border-0 p-0" title="Edit">
                                        <i class="bi bi-pencil-square fs-5 hover-warning"></i>
                                    </a>

                                    <a href="/pop/<%= post.id %>/delete" 
                                       class="btn btn-sm text-secondary border-0 p-0" 
                                       onclick="return confirm('Yakin ingin menghapus?')"
                                       title="Hapus">
                                        <i class="bi bi-trash text-danger fs-5"></i>
                                    </a>
                                </div>

                            </div>

                            <p class="mt-3 mb-2" style="white-space: pre-wrap;"><%- formatHashtag(post.content) %></p>
                            
                            <% if (post.picture) { %>
                                <div class="mt-3">
                                    <img src="<%= post.picture %>" class="img-fluid rounded-4 w-100 object-fit-cover shadow-sm" style="max-height: 400px;" alt="Post Image">
                                </div>
                            <% } %>
                            
                            <% if(post.Hashtags && post.Hashtags.length > 0) { %>
                                <div class="mt-2 border-top pt-2">
                                    <% post.Hashtags.forEach(tag => { %>
                                        <span class="text-pop me-2 small fw-bold"><%= tag.name %></span>
                                    <% }) %>
                                </div>
                            <% } %>

                        </div>
                    </div>
                <% }) %>
            <% } %>

        </div>

      </div>
    </div>
  </section>

</body>
</html>